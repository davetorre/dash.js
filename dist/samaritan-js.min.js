!function(a){"use strict";var b=function(a,c,d){return 1===arguments.length?b.get(a):b.set(a,c,d)};b._document=document,b._navigator=navigator,b.defaults={path:"/"},b.get=function(a){return b._cachedDocumentCookie!==b._document.cookie&&b._renewCache(),b._cache[a]},b.set=function(c,d,e){return e=b._getExtendedOptions(e),e.expires=b._getExpiresDate(d===a?-1:e.expires),b._document.cookie=b._generateCookieString(c,d,e),b},b.expire=function(c,d){return b.set(c,a,d)},b._getExtendedOptions=function(c){return{path:c&&c.path||b.defaults.path,domain:c&&c.domain||b.defaults.domain,expires:c&&c.expires||b.defaults.expires,secure:c&&c.secure!==a?c.secure:b.defaults.secure}},b._isValidDate=function(a){return"[object Date]"===Object.prototype.toString.call(a)&&!isNaN(a.getTime())},b._getExpiresDate=function(a,c){switch(c=c||new Date,typeof a){case"number":a=new Date(c.getTime()+1e3*a);break;case"string":a=new Date(a)}if(a&&!b._isValidDate(a))throw new Error("`expires` parameter cannot be converted to a valid Date instance");return a},b._generateCookieString=function(a,b,c){a=encodeURIComponent(a),b=(b+"").replace(/[^!#$&-+\--:<-\[\]-~]/g,encodeURIComponent),c=c||{};var d=a+"="+b;return d+=c.path?";path="+c.path:"",d+=c.domain?";domain="+c.domain:"",d+=c.expires?";expires="+c.expires.toGMTString():"",d+=c.secure?";secure":""},b._getCookieObjectFromString=function(c){for(var d={},e=c?c.split("; "):[],f=0;f<e.length;f++){var g=b._getKeyValuePairFromCookieString(e[f]);d[g.key]===a&&(d[g.key]=g.value)}return d},b._getKeyValuePairFromCookieString=function(a){var b=a.indexOf("=");return b=0>b?a.length:b,{key:decodeURIComponent(a.substr(0,b)),value:decodeURIComponent(a.substr(b+1))}},b._renewCache=function(){b._cache=b._getCookieObjectFromString(b._document.cookie),b._cachedDocumentCookie=b._document.cookie},b._areEnabled=function(){return b._navigator.cookieEnabled||"1"===b.set("cookies.js",1).get("cookies.js")},b.enabled=b._areEnabled(),"function"==typeof define&&define.amd?define(function(){return b}):"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=b),exports.Cookies=b):window.Cookies=b}(),function(){"use strict";window.namespace=function(a){for(var b,c=window,d=a.split(".");b=d.shift();)c[b]=c[b]||{},c=c[b]}}(window._),namespace("Browser"),function(){"use strict";Browser.Location={change:function(a){window.location.replace(a)},hash:function(){return window.location.hash}},Browser.open=function(a,b){return window.open(a,"_blank",b)},Browser.setTimeout=function(a,b){return window.setTimeout(a,b)},Browser.setInterval=function(a,b){return window.setInterval(a,b)}}(),namespace("Config"),function(){"use strict";Config.Endpoints={authorization:"https://smchcn.net/asrv/SMI/oauth/authorize",tokenConfirmation:"https://smchcn.net/smiIdentity/api/tokenConfirmation",identityLogOff:"https://smchcn.net/smiIdentity/api/logoff",authorizationLogOff:"https://smchcn.net/asrv/?wa=wsignoutcleanup1.0"}}(),namespace("SamaritanJs.OAuth"),function(a){"use strict";SamaritanJs.OAuth.Cookie={names:{redirect:"SamaritanJsOAuthRedirect",state:"SamaritanJsOAuthState",token:"SamaritanJsOAuthToken"},set:function(b,c,d){return a.set(b,c,d)},get:function(b){return a.get(b)},expire:function(b){return a.expire(b)}}}(Cookies),namespace("SamaritanJs.OAuth"),function(){"use strict";SamaritanJs.OAuth.Params=function(a){this.queryString=a,this.queryStringToObject=function(){var a={},b=this.queryString.slice(1).split("&");return b.forEach(function(b){var c=b.split("=");a[c[0]]=c[1]}),a},this.get=function(a){return this.queryStringToObject()[a]}}}(),namespace("SamaritanJs.OAuth"),function(a,b){"use strict";SamaritanJs.OAuth.UrlGenerator=function(c){this.baseUrl=c.baseUrl,this.clientId=c.clientId||"smi_platform",this.context=c.context,this.redirectUrl=c.redirectUrl,this.responseType=c.responseType,this.scopes=c.scopes||["identity","needs","profile","membership","enroll"],this.state=a.create().hex,this.generate=function(){var a=b.param({scope:this.scopes.join(" "),state:this.state,redirect_uri:this.redirectUrl,client_id:this.clientId,response_type:this.responseType,context:this.context});return this.baseUrl+"?"+a}}}(UUIDjs,jQuery),namespace("SamaritanJs.OAuth"),function(a){"use strict";SamaritanJs.OAuth.TokenAccessor={set:function(b,c,d){d=parseInt(d),a.set(this.key(b),c,{expires:d}),null!=d?a.set(this.expiresInKey(b),this._futureUnixTime(d),{expires:d}):this.expireExpiresIn(b)},get:function(b){return a.get(this.key(b))},_futureUnixTime:function(a){var b=1e3*parseInt(a);return new Date(Date.now()+b).valueOf()},getExpiresIn:function(b){var c=parseInt(a.get(this.expiresInKey(b)));return isNaN(c)?1/0:(c-Date.now())/1e3},expire:function(b){a.expire(this.key(b)),this.expireExpiresIn(b)},expireExpiresIn:function(b){a.expire(this.expiresInKey(b))},prefix:"smi-access-token:",expiresInPrefix:"smi-access-token-expiration:",key:function(a){return""+this.prefix+a},expiresInKey:function(a){return""+this.expiresInPrefix+a},expireAll:function(a){var b=this;$.each(a,function(a,c){b.expire(c)})}}}(SamaritanJs.OAuth.Cookie),namespace("SamaritanJs.OAuth"),function(){"use strict";SamaritanJs.OAuth.TokenRefreshIframe=function(a){this.modalDataId="refresh-modal",this.$el=$('<iframe data-id="'+this.modalDataId+'" src="'+a+'"></iframe>'),this.render=function(){this.$el.hide(),$("body").append(this.$el)},this.remove=function(){this.$el.remove()}}}(),namespace("SamaritanJs.OAuth"),function(a){"use strict";SamaritanJs.OAuth.TokenValidator=function(b,c,d){this.expiration=d,this.state=b,this.token=c,this.isValidState=function(){return a.get(a.names.state)===this.state},this.storeToken=function(){return a.set(a.names.token,this.token,{expires:this.expiration})},this.removeToken=function(){return a.expire(a.names.token)},this.storedToken=function(){return a.get(a.names.token)},this.hasStoredToken=function(){return void 0!==a.get(a.names.token)}}}(SamaritanJs.OAuth.Cookie),namespace("SamaritanJs.OAuth"),function(a,b){"use strict";SamaritanJs.OAuth.AccessRequester=function(c){var d=300;this.urlGenerator=c,this.storeState=function(){a.set(a.names.state,this.urlGenerator.state,{expires:d})},this.requestAccess=function(){this.storeState(),this.sendRequest()},this.sendRequest=function(){b.Location.change(this.urlGenerator.generate())}}}(SamaritanJs.OAuth.Cookie,Browser),function(){var a=function(a,b){return function(){return a.apply(b,arguments)}};namespace("SamaritanJs.OAuth"),SamaritanJs.OAuth.AutoRefresh=function(){function b(b,c,d){this.appId=b,this.url=c,this.state=d,this.refreshLocation=a(this.refreshLocation,this)}return b.prototype.modalDataId="refresh-modal",b.prototype.checkForTokenInterval=200,b.prototype.register=function(){var a,b,c=this;return a=SamaritanJs.OAuth.TokenAccessor.getExpiresIn(this.appId),b=1e3*a,this.timeoutId=Browser.setTimeout(function(){return c.trigger()},b)},b.prototype.trigger=function(){return this.shouldShowModal()?(this.cleanUp(),this.renderModal()):void 0},b.prototype.renderModal=function(){var a=this;return SamaritanJs.OAuth.TokenAccessor.expire(this.appId),SamaritanJs.OAuth.Cookie.set("isAutoRefresh","true",10),new SamaritanJs.OAuth.AccessRequester({state:this.state}).storeState(),this.modal=this.createModal(this.url),this.modal.render(),this.refreshPageTimeoutId=Browser.setTimeout(this.refreshLocation,2e3),this.intervalId=Browser.setInterval(function(){return a.closeModal()},this.checkForTokenInterval)},b.prototype.createModal=function(a){return new SamaritanJs.OAuth.TokenRefreshIframe(a)},b.prototype.refreshLocation=function(){return SamaritanJs.OAuth.AutoRefresh.expireFlag(),Browser.Location.change(this.url)},b.prototype.closeModal=function(){return void 0!=SamaritanJs.OAuth.TokenAccessor.get(this.appId)?(this.cleanUp(),this.register()):void 0},b.prototype.cleanUp=function(){var a;return clearTimeout(this.timeoutId),clearTimeout(this.refreshPageTimeoutId),clearInterval(this.intervalId),null!=(a=this.modal)?a.remove():void 0},b.prototype.shouldShowModal=function(){return this.appId===this.currentAppId()},b.prototype.currentAppId=function(){var a;return null!=(a=Browser.Location.hash().match(/#(.*)/))?a[1]:void 0},b.expireFlag=function(){return SamaritanJs.OAuth.Cookie.expire("isAutoRefresh")},b.isFlagSet=function(){return void 0!=SamaritanJs.OAuth.Cookie.get("isAutoRefresh")},b}()}.call(this),namespace("SamaritanJs.OAuth"),function(){"use strict";SamaritanJs.OAuth.Response=function(a){this.normalizedLocationHash=function(a){var b;return b=a.split("#"),2===b.length?"?"+b[1]:3===b.length?"?"+b[2]:void 0},this.params=new SamaritanJs.OAuth.Params(this.normalizedLocationHash(a)),this.token=function(){return this.params.get("access_token")},this.context=function(){return this.params.get("context")},this.expiresIn=function(){return this.params.get("expires_in")},this.isValidState=function(){var a,b,c;return b=this.params.get("state"),a=this.params.get("expires_in"),c=new SamaritanJs.OAuth.TokenValidator(b,this.token(),a),c.isValidState()}}}();